# Production environment overrides for spring-playground
# Usage: helm install spring-playground ./helm/spring-playground -f helm/spring-playground/values-prod.yaml

# Higher replica count for production HA
replicaCount: 3

application:
  environment: prod
  logLevel: WARN

# Production resource requirements
resources:
  limits:
    cpu: 2000m
    memory: 2Gi
  requests:
    cpu: 1000m
    memory: 1Gi

# Longer startup times for production stability
livenessProbe:
  initialDelaySeconds: 90
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 5

readinessProbe:
  initialDelaySeconds: 45
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# PostgreSQL with production resources
postgresql:
  enabled: true
  auth:
    username: postgres
    # In production, use Kubernetes secret
    existingSecret: postgresql-secret
  primary:
    persistence:
      enabled: true
      size: 20Gi
      storageClass: gp3  # AWS EBS gp3 for better performance
  resources:
    limits:
      cpu: 2000m
      memory: 2Gi
    requests:
      cpu: 1000m
      memory: 1Gi
  # Production backup configuration
  backup:
    enabled: true
    schedule: "0 2 * * *"  # Daily at 2 AM
    retention: 7  # Keep 7 days of backups

# Enable autoscaling in production
autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 10
  targetCPUUtilizationPercentage: 60
  targetMemoryUtilizationPercentage: 70

# Production pod disruption budget
podDisruptionBudget:
  enabled: true
  minAvailable: 2

# Production affinity rules - spread across zones
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/name
            operator: In
            values:
            - spring-playground
        topologyKey: topology.kubernetes.io/zone

# Production security context - more restrictive
securityContext:
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000
  allowPrivilegeEscalation: false
