---
env:
  contexts:
    - name: "Spring Playground API"
      urls:
        - "http://host.docker.internal:8080.*"
      includePaths: []
      excludePaths:
        - "http://host.docker.internal:8080/actuator/shutdown.*"
        - ".*\\.js"
        - ".*\\.css"
        - ".*\\.png"
        - ".*\\.jpg"
      authentication:
        method: "none"
      sessionManagement:
        method: "cookie"
      technology:
        exclude: []
  parameters:
    failOnError: true
    failOnWarning: false
    progressToStdout: true
  vars: {}

jobs:
  # Configure passive scanning
  - type: passiveScan-config
    parameters:
      maxAlertsPerRule: 10
      scanOnlyInScope: true

  # Spider the application
  - type: spider
    parameters:
      context: "Spring Playground API"
      url: "http://host.docker.internal:8080"
      maxDuration: 5
      maxDepth: 5
      maxChildren: 10

  # AJAX Spider for modern web apps
  - type: spiderAjax
    parameters:
      context: "Spring Playground API"
      url: "http://host.docker.internal:8080"
      maxDuration: 5
      maxCrawlDepth: 5

  # Wait for passive scanning to complete
  - type: passiveScan-wait
    parameters:
      maxDuration: 10

  # Run active scan
  - type: activeScan
    parameters:
      context: "Spring Playground API"
      url: "http://host.docker.internal:8080"
      maxRuleDurationInMins: 5
      maxScanDurationInMins: 15
      maxAlertsPerRule: 10
      scanOnlyInScope: true
      # Scan policy (default, SQL-injection, etc.)
      policy: "Default Policy"

  # Active scan specific endpoints
  - type: activeScan
    parameters:
      context: "Spring Playground API"
      url: "http://host.docker.internal:8080/api/users"
      maxRuleDurationInMins: 3
      maxScanDurationInMins: 10

  - type: activeScan
    parameters:
      context: "Spring Playground API"
      url: "http://host.docker.internal:8080/api/posts"
      maxRuleDurationInMins: 3
      maxScanDurationInMins: 10

  # Wait for active scanning to complete
  - type: activeScan-wait
    parameters:
      maxDuration: 30

  # Generate HTML report
  - type: report
    parameters:
      template: traditional-html
      reportDir: /zap/wrk/
      reportFile: zap-report.html
      reportTitle: "Spring Playground Security Scan Report"
      reportDescription: "Automated security scan of Spring Boot REST API"

  # Generate JSON report for CI/CD integration
  - type: report
    parameters:
      template: traditional-json
      reportDir: /zap/wrk/
      reportFile: zap-report.json

  # Generate XML report
  - type: report
    parameters:
      template: traditional-xml
      reportDir: /zap/wrk/
      reportFile: zap-report.xml

# Risk configurations
risk:
  high:
    - "SQL Injection"
    - "Remote OS Command Injection"
    - "Path Traversal"
    - "Cross Site Scripting (Reflected)"
    - "Cross Site Scripting (Persistent)"
  medium:
    - "Cross Site Request Forgery"
    - "Session Fixation"
    - "Absence of Anti-CSRF Tokens"
  low:
    - "X-Content-Type-Options Header Missing"
    - "X-Frame-Options Header Not Set"
